<section class="hero">
    <div class="hero-content">
        <h1>Carrito de Compras</h1>
        <p>Revisa y finaliza tu compra</p>
    </div>
</section>

<section class="container">
    <div class="cart-page">
        <div class="cart-items-container">
            <h2 class="section-title">Tus productos</h2>
            
            <div id="cart-items-list">
                <div class="empty-cart-message" style="display: none;">
                    <p>Tu carrito está vacío</p>
                    <a href="/productos" class="btn">Ver productos</a>
                </div>
            </div>
            
            <div class="cart-summary">
                <div class="cart-total">
                    <span>Total:</span>
                    <span id="cart-total-price">$0</span>
                </div>
            </div>
        </div>
        
        <div class="checkout-container">
            <h2 class="section-title">Información de contacto</h2>
            
            <form id="checkout-form">
                <div class="required-note">
                    <span>*</span> Campos obligatorios
                </div>
                
                <div class="form-section">
                    <h3>Datos personales</h3>
                    
                    <div class="form-group">
                        <label for="nombres" class="required">Nombre(s)</label>
                        <input type="text" id="nombres" name="nombres" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="apellidos" class="required">Apellidos</label>
                        <input type="text" id="apellidos" name="apellidos" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="tipo_documento" class="required">Tipo de Documento de Identidad</label>
                        <select id="tipo_documento" name="tipo_documento" required>
                            <option value="" disabled selected>Seleccione una opción</option>
                            <option value="CC">Cédula de Ciudadanía</option>
                            <option value="CE">Cédula de Extranjería</option>
                            <option value="PASAPORTE">Pasaporte</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="num_documento" class="required">Número de Documento de Identidad</label>
                        <input type="text" id="num_documento" name="num_documento" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="fecha_nacimiento" class="required">Fecha de Nacimiento (Mayor de 18 años)</label>
                        <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="sexo">Sexo</label>
                        <select id="sexo" name="sexo">
                            <option value="" disabled selected>Seleccione una opción</option>
                            <option value="M">Masculino</option>
                            <option value="F">Femenino</option>
                            <option value="O">Otro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="estado_civil">Estado Civil</label>
                        <select id="estado_civil" name="estado_civil">
                            <option value="" disabled selected>Seleccione una opción</option>
                            <option value="soltero">Soltero/a</option>
                            <option value="casado">Casado/a</option>
                            <option value="union_libre">Unión Libre</option>
                            <option value="separado">Separado/a</option>
                            <option value="divorciado">Divorciado/a</option>
                            <option value="viudo">Viudo/a</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Datos de contacto</h3>
                    
                    <div class="form-group">
                        <label for="ciudad" class="required">Ciudad</label>
                        <select id="ciudad" name="ciudad" required>
                            <option value="" disabled selected>Seleccione una ciudad</option>
                            <option value="Medellín">Medellín</option>
                            <option value="Bello">Bello</option>
                            <option value="Envigado">Envigado</option>
                            <option value="Itagüí">Itagüí</option>
                            <option value="Sabaneta">Sabaneta</option>
                            <option value="La Estrella">La Estrella</option>
                            <option value="Caldas">Caldas</option>
                            <option value="Copacabana">Copacabana</option>
                            <option value="Girardota">Girardota</option>
                            <option value="Barbosa">Barbosa</option>
                            <option value="Rionegro">Rionegro</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="direccion" class="required">Dirección de entrega</label>
                        <input type="text" id="direccion" name="direccion" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="telefono_fijo">Teléfono Fijo</label>
                        <input type="tel" id="telefono_fijo" name="telefono_fijo">
                    </div>
                    
                    <div class="form-group">
                        <label for="telefono_movil" class="required">Teléfono Móvil</label>
                        <input type="tel" id="telefono_movil" name="telefono_movil" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="required">Correo Electrónico</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3>Método de pago</h3>
                    <div class="payment-methods">
                        <div class="payment-method">
                            <input type="radio" id="bancolombia" name="metodo_pago" value="Bancolombia" checked>
                            <label for="bancolombia">
                                <span class="payment-icon"><i class="fas fa-university"></i></span>
                                <span class="payment-name">Bancolombia</span>
                            </label>
                        </div>
                        
                        <div class="payment-method">
                            <input type="radio" id="nequi" name="metodo_pago" value="Nequi">
                            <label for="nequi">
                                <span class="payment-icon"><i class="fas fa-mobile-alt"></i></span>
                                <span class="payment-name">Nequi</span>
                            </label>
                        </div>
                        
                        <div class="payment-method">
                            <input type="radio" id="contraentrega" name="metodo_pago" value="Contra Entrega">
                            <label for="contraentrega">
                                <span class="payment-icon"><i class="fas fa-truck"></i></span>
                                <span class="payment-name">Pago Contra Entrega</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="payment-details" id="payment-details-container">
                    </div>
                </div>
                
                <div class="checkout-actions">
                    <button type="button" class="btn btn-secondary" id="seguir-comprando-btn">Seguir Comprando</button>
                    <button type="submit" class="btn" id="finalizar-compra-btn">Confirmar Pedido</button>
                </div>
            </form>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Configurar validación de edad (mayor de 18 años)
        const fechaNacimiento = document.getElementById('fecha_nacimiento');
        if (fechaNacimiento) {
            // Calcular fecha máxima (18 años atrás desde hoy)
            const hoy = new Date();
            const maxDate = new Date();
            maxDate.setFullYear(hoy.getFullYear() - 18);
            
            // Formatear fecha en formato YYYY-MM-DD para el input date
            const maxDateStr = maxDate.toISOString().split('T')[0];
            fechaNacimiento.setAttribute('max', maxDateStr);
        }
        
        // Cargar carrito desde localStorage de checkout
        loadCartFromCheckout();
        
        // Inicializar detalles de pago
        updatePaymentDetails();
        
        // Event listeners
        document.querySelectorAll('input[name="metodo_pago"]').forEach(radio => {
            radio.addEventListener('change', updatePaymentDetails);
        });
        
        // Event listener para el formulario de checkout
        const checkoutForm = document.getElementById('checkout-form');
        if (checkoutForm) {
            checkoutForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // Validar campos y enviar pedido
                enviarPedidoWhatsApp();
            });
        }
        
        // Manejar botón "Seguir comprando" - NUEVA FUNCIONALIDAD
        const seguirComprandoBtn = document.getElementById('seguir-comprando-btn');
        if (seguirComprandoBtn) {
            seguirComprandoBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Restaurar carrito flotante desde checkout
                if (typeof window.restoreCarritoFromCheckout === 'function') {
                    window.restoreCarritoFromCheckout();
                } else {
                    // Función de respaldo
                    restoreCarritoFromCheckoutLocal();
                }
                
                // Redirigir a productos
                window.location.href = '/productos';
            });
        }

        setTimeout(() => {
         loadCartFromCheckout();
        }, 200);
        
        // Verificar periódicamente si hay cambios en el carrito de checkout
        setInterval(function() {
            if (document.hasFocus()) {
                loadCartFromCheckout();
            }
        }, 2000);
    });
    

    function loadCartFromCheckout() {
        console.log('Cargando carrito desde checkout storage...');
        
        // Obtener elementos del DOM
        const cartItemsList = document.getElementById('cart-items-list');
        const emptyCartMessage = document.querySelector('.empty-cart-message');
        const cartTotalPrice = document.getElementById('cart-total-price');
        const finalizarCompraBtn = document.getElementById('finalizar-compra-btn');
        
        if (!cartItemsList || !cartTotalPrice) return;
        
        // Obtener carrito desde checkout localStorage
        let carrito;
        try {
            carrito = JSON.parse(localStorage.getItem('carritoCheckout')) || { items: [], total: 0 };
        } catch (e) {
            carrito = { items: [], total: 0 };
            console.error('Error al parsear carrito checkout:', e);
        }
        
        // Mostrar mensaje si el carrito está vacío
        if (!carrito.items || carrito.items.length === 0) {
            if (emptyCartMessage) emptyCartMessage.style.display = 'block';
            if (finalizarCompraBtn) finalizarCompraBtn.disabled = true;
            cartItemsList.innerHTML = '';
            cartTotalPrice.textContent = '$0';
            return;
        }
        
        // Ocultar mensaje de carrito vacío
        if (emptyCartMessage) emptyCartMessage.style.display = 'none';
        if (finalizarCompraBtn) finalizarCompraBtn.disabled = false;
        
        // Limpiar la lista de productos
        cartItemsList.innerHTML = '';
        
        // Variables para calcular el total
        let total = 0;
        
        // Mostrar cada producto en el carrito
        carrito.items.forEach(item => {
            const precio = parseFloat(item.precio) || 0;
            const cantidad = parseInt(item.cantidad) || 0;
            const subtotal = precio * cantidad;
            total += subtotal;
            const maxStock = parseInt(item.stock) || 999;
            
            // Crear elemento para el producto
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
                <div class="cart-item-img">
                    <img src="${item.imagen || '/img/default-product.jpg'}" alt="${item.nombre}">
                </div>
                <div class="cart-item-details">
                    <h3>${item.nombre}</h3>
                    <p class="item-price">$${precio.toLocaleString('es-CO')}</p>
                    <p class="item-stock">Stock disponible: ${maxStock}</p>
                    <div class="item-quantity">
                        <button class="quantity-btn minus" data-id="${item.id}" ${cantidad <= 1 ? 'disabled' : ''}>-</button>
                        <span class="quantity-display">${cantidad}</span>
                        <button class="quantity-btn plus" data-id="${item.id}" ${cantidad >= maxStock ? 'disabled' : ''}>+</button>
                    </div>
                </div>
                <div class="cart-item-subtotal">
                    <p>$${subtotal.toLocaleString('es-CO')}</p>
                    <button class="remove-item" data-id="${item.id}">×</button>
                </div>
            `;
            
            cartItemsList.appendChild(cartItem);
        });
        
        // Actualizar total en la interfaz
        cartTotalPrice.textContent = `$${total.toLocaleString('es-CO')}`;
        
        // Actualizar total en el carrito y guardarlo
        carrito.total = total;
        localStorage.setItem('carritoCheckout', JSON.stringify(carrito));
        
        // Añadir event listeners a los botones
        addCartEventListeners();
        
        console.log('Carrito checkout cargado correctamente');
    }

    // Añadir event listeners a los botones del carrito con validación de stock
    function addCartEventListeners() {
        // Botones de incremento y decremento de cantidad
        document.querySelectorAll('#cart-items-list .quantity-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                if (this.disabled) return;
                
                const productId = this.getAttribute('data-id');
                const isPlus = this.classList.contains('plus');
                
                console.log(`${isPlus ? 'Incrementando' : 'Decrementando'} producto ${productId} en checkout`);
                updateProductQuantityCheckout(productId, isPlus);
            });
        });
        
        // Botones para eliminar productos
        document.querySelectorAll('#cart-items-list .remove-item').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const productId = this.getAttribute('data-id');
                console.log(`Eliminando producto ${productId} del checkout`);
                removeProductFromCheckout(productId);
            });
        });
    }
    
    function updateProductQuantityCheckout(productId, isIncrement) {
        console.log(`updateProductQuantityCheckout: ${productId}, incrementar: ${isIncrement}`);
        
        // Obtener carrito de checkout
        let carrito = JSON.parse(localStorage.getItem('carritoCheckout')) || { items: [], total: 0 };
        
        // Encontrar el producto
        const productIndex = carrito.items.findIndex(item => String(item.id) === String(productId));
        
        if (productIndex !== -1) {
            const item = carrito.items[productIndex];
            const maxStock = parseInt(item.stock) || 999;
            
            if (isIncrement) {
                // Validar stock antes de incrementar
                if (item.cantidad < maxStock) {
                    carrito.items[productIndex].cantidad += 1;
                    console.log(`Incrementado a ${carrito.items[productIndex].cantidad}`);
                } else {
                    showToast(`Solo hay ${maxStock} unidades disponibles de ${item.nombre}`, 'error');
                    return;
                }
            } else {
                // Decrementar cantidad
                carrito.items[productIndex].cantidad -= 1;
                console.log(`Decrementado a ${carrito.items[productIndex].cantidad}`);
                
                // Remover si la cantidad llega a 0
                if (carrito.items[productIndex].cantidad <= 0) {
                    console.log(`Removiendo producto ${productId} del checkout`);
                    carrito.items.splice(productIndex, 1);
                }
            }
            
            // Recalcular total
            carrito.total = carrito.items.reduce((total, item) => {
                return total + ((parseFloat(item.precio) || 0) * (parseInt(item.cantidad) || 0));
            }, 0);
            
            console.log(`Nuevo total checkout: ${carrito.total}`);
            
            // Guardar carrito y recargar
            localStorage.setItem('carritoCheckout', JSON.stringify(carrito));
            
            // Actualizar vista inmediatamente
            loadCartFromCheckout();
        } else {
            console.error(`Producto ${productId} no encontrado en el checkout`);
        }
    }
    
    function removeProductFromCheckout(productId) {
        console.log(`removeProductFromCheckout: ${productId}`);
        
        // Obtener carrito
        let carrito = JSON.parse(localStorage.getItem('carritoCheckout')) || { items: [], total: 0 };
        
        // Obtener nombre del producto antes de eliminarlo
        const product = carrito.items.find(item => String(item.id) === String(productId));
        const productName = product ? product.nombre : 'Producto';
        
        // Filtrar el producto
        const originalLength = carrito.items.length;
        carrito.items = carrito.items.filter(item => String(item.id) !== String(productId));
        
        if (carrito.items.length < originalLength) {
            console.log(`Producto ${productName} eliminado del checkout`);
            
            // Recalcular total
            carrito.total = carrito.items.reduce((total, item) => {
                return total + ((parseFloat(item.precio) || 0) * (parseInt(item.cantidad) || 0));
            }, 0);
            
            // Guardar carrito y recargar
            localStorage.setItem('carritoCheckout', JSON.stringify(carrito));
            loadCartFromCheckout();
            
            showToast(`${productName} eliminado del carrito`);
        } else {
            console.error(`No se pudo eliminar el producto ${productId}`);
        }
    }
    

    function restoreCarritoFromCheckoutLocal() {
        try {
            const carritoCheckout = JSON.parse(localStorage.getItem('carritoCheckout')) || { items: [], total: 0 };
            
            if (carritoCheckout.items && carritoCheckout.items.length > 0) {
                // Restaurar al carrito flotante
                localStorage.setItem('carrito', JSON.stringify(carritoCheckout));
                console.log('Carrito restaurado desde checkout (función local)');
                showToast('Carrito restaurado para seguir comprando');
            }
        } catch (error) {
            console.error('Error al restaurar carrito desde checkout (función local):', error);
        }
    }
    
    function updatePaymentDetails() {
        const container = document.getElementById('payment-details-container');
        const selectedMethod = document.querySelector('input[name="metodo_pago"]:checked');
        const paymentMethod = selectedMethod ? selectedMethod.value : 'Bancolombia';
        
        if (!container) return;
        
        let content = '';
        
        switch (paymentMethod) {
            case 'Bancolombia':
                content = `
                    <div class="payment-info">
                        <p><strong>Cuenta de Ahorros Bancolombia</strong></p>
                        <p>Número: 00221706692</p>
                        <p>Titular: Leidy Yohanna Montoya</p>
                        <p>NIT: 1046666351-7</p>
                        <p class="payment-note">Una vez realices la transferencia, envíanos el comprobante por WhatsApp para agilizar tu pedido.</p>
                    </div>
                `;
                break;
                
            case 'Nequi':
                content = `
                    <div class="payment-info">
                        <p><strong>Pago con Nequi</strong></p>
                        <p>Número: 3137593418</p>
                        <p>Nombre: Leidy Yohanna Montoya</p>
                        <p class="payment-note">Una vez realices el pago, envíanos la captura de pantalla por WhatsApp para agilizar tu pedido.</p>
                    </div>
                `;
                break;
                
            case 'Contra Entrega':
                content = `
                    <div class="payment-info">
                        <p><strong>Pago Contra Entrega</strong></p>
                        <p>Pagarás cuando recibas tu pedido.</p>
                        <p>Puedes pagar en efectivo o con tarjeta al momento de la entrega.</p>
                        <p class="payment-note">Este método tiene un recargo adicional de $5.000 por gastos de envío.</p>
                    </div>
                `;
                break;
        }
        
        container.innerHTML = content;
    }
    
    // Función para enviar pedido por WhatsApp con validación 
    function enviarPedidoWhatsApp() {
        const form = document.getElementById('checkout-form');
        
        if (!form) return;
        
        // Validar campos requeridos
        const camposRequeridos = [
            'nombres', 'apellidos', 'tipo_documento', 'num_documento',
            'fecha_nacimiento', 'ciudad', 'direccion', 'telefono_movil', 'email'
        ];
        
        let formularioValido = true;
        camposRequeridos.forEach(campo => {
            const input = form.querySelector(`[name="${campo}"]`);
            if (!input || !input.value.trim()) {
                if (input) {
                    input.classList.add('error');
                }
                formularioValido = false;
            } else {
                if (input) {
                    input.classList.remove('error');
                }
            }
        });
        
        // Validar mayoría de edad (18 años)
        const fechaNacimiento = form.querySelector('[name="fecha_nacimiento"]');
        if (fechaNacimiento && fechaNacimiento.value) {
            const fechaNac = new Date(fechaNacimiento.value);
            const hoy = new Date();
            let edad = hoy.getFullYear() - fechaNac.getFullYear();
            const m = hoy.getMonth() - fechaNac.getMonth();
            
            if (m < 0 || (m === 0 && hoy.getDate() < fechaNac.getDate())) {
                edad--;
            }
            
            if (edad < 18) {
                fechaNacimiento.classList.add('error');
                showToast('Debe ser mayor de 18 años para realizar un pedido', 'error');
                formularioValido = false;
            }
        }
        
        if (!formularioValido) {
            showToast('Por favor, completa todos los campos obligatorios correctamente', 'error');
            return;
        }
        
        // Obtener datos del formulario (todos los campos)
        const nombres = form.querySelector('[name="nombres"]').value;
        const apellidos = form.querySelector('[name="apellidos"]').value;
        const tipoDocumento = form.querySelector('[name="tipo_documento"]').value;
        const numDocumento = form.querySelector('[name="num_documento"]').value;
        const fechaNacimientoValue = form.querySelector('[name="fecha_nacimiento"]').value;
        const ciudad = form.querySelector('[name="ciudad"]').value;
        const direccion = form.querySelector('[name="direccion"]').value;
        const telefonoMovil = form.querySelector('[name="telefono_movil"]').value;
        const email = form.querySelector('[name="email"]').value;
        const metodoPago = form.querySelector('[name="metodo_pago"]:checked').value;
        
        // Campos opcionales
        const sexo = form.querySelector('[name="sexo"]') ? form.querySelector('[name="sexo"]').value : 'No especificado';
        const estadoCivil = form.querySelector('[name="estado_civil"]') ? form.querySelector('[name="estado_civil"]').value : 'No especificado';
        const telefonoFijo = form.querySelector('[name="telefono_fijo"]') ? form.querySelector('[name="telefono_fijo"]').value : 'No proporcionado';
        
        // Obtener carrito de checkout
        const carrito = getCarritoCheckoutFromStorage();
        
        if (carrito.items.length === 0) {
            showToast('El carrito está vacío', 'error');
            return;
        }
        
        // Crear mensaje de WhatsApp completo con todos los campos
        let mensaje = `*Nuevo Pedido*%0A%0A`;
        mensaje += `*Nombres:* ${nombres}%0A`;
        mensaje += `*Apellidos:* ${apellidos}%0A`;
        mensaje += `*Documento:* ${tipoDocumento} ${numDocumento}%0A`;
        mensaje += `*Fecha Nacimiento:* ${fechaNacimientoValue}%0A`;
        mensaje += `*Ciudad:* ${ciudad}%0A`;
        mensaje += `*Dirección:* ${direccion}%0A`;
        mensaje += `*Teléfono Móvil:* ${telefonoMovil}%0A`;
        mensaje += `*Email:* ${email}%0A`;
        mensaje += `*Teléfono Fijo:* ${telefonoFijo}%0A`;
        mensaje += `*Sexo:* ${sexo}%0A`;
        mensaje += `*Estado Civil:* ${estadoCivil}%0A`;
        mensaje += `*Método de Pago:* ${metodoPago}%0A%0A`;
        mensaje += `*Productos:*%0A`;
        
        let total = 0;
        carrito.items.forEach(item => {
            const precio = parseFloat(item.precio) || 0;
            const cantidad = parseInt(item.cantidad) || 0;
            const subtotal = precio * cantidad;
            total += subtotal;
            mensaje += `- ${cantidad}x ${item.nombre} - $${subtotal.toLocaleString('es-CO')}%0A`;
        });
        
        mensaje += `%0A*Total:* $${total.toLocaleString('es-CO')}`;
        
        // Número de WhatsApp de prueba
        const whatsappNumber = '573225865591';
        
        // Crear URL de WhatsApp
        const whatsappUrl = `https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${mensaje}`;
        
        // Mostrar confirmación
        showToast('¡Pedido enviado correctamente! Abriendo WhatsApp...');
        
        // Abrir WhatsApp en una nueva ventana
        window.open(whatsappUrl, '_blank');
        
        // Limpiar carritos después de enviar
        localStorage.removeItem('carrito');
        localStorage.removeItem('carritoCheckout');
        
        // Redirigir a la página de confirmación
        setTimeout(() => {
            window.location.href = '/pedidos/confirmacion';
        }, 2000);
    }
    
    function getCarritoCheckoutFromStorage() {
        const carritoJSON = localStorage.getItem('carritoCheckout');
        
        if (carritoJSON) {
            try {
                return JSON.parse(carritoJSON);
            } catch (e) {
                console.error('Error al parsear carrito checkout:', e);
            }
        }
        
        // Carrito por defecto
        return {
            items: [],
            total: 0
        };
    }
    
    function showToast(message, tipo = 'success') {
        // Verificar si ya existe un toast
        let toast = document.querySelector('.toast');
        
        // Si no existe, crear uno nuevo
        if (!toast) {
            toast = document.createElement('div');
            toast.className = 'toast';
            document.body.appendChild(toast);
        }
        
        // Limpiar clases previas
        toast.className = 'toast';
        
        // Añadir clase según el tipo
        if (tipo === 'error') {
            toast.classList.add('toast-error');
            toast.style.backgroundColor = '#e74c3c';
        } else {
            toast.classList.add('toast-success');
            toast.style.backgroundColor = '#2ecc71';
        }
        
        toast.style.color = 'white';
        toast.style.position = 'fixed';
        toast.style.bottom = '20px';
        toast.style.left = '50%';
        toast.style.transform = 'translateX(-50%)';
        toast.style.padding = '12px 24px';
        toast.style.borderRadius = '4px';
        toast.style.zIndex = '9999';
        toast.style.fontSize = '14px';
        toast.style.transition = 'opacity 0.3s ease';
        toast.style.opacity = '1';
        
        // Añadir icono según el tipo
        let icono = tipo === 'success' ? 
            '<i class="fas fa-check-circle" style="margin-right: 8px;"></i>' : 
            '<i class="fas fa-exclamation-circle" style="margin-right: 8px;"></i>';
        
        // Establecer el contenido
        toast.innerHTML = `${icono}<span>${message}</span>`;
        
        // Mostrar toast
        toast.classList.add('show');
        
        // Ocultar después del tiempo apropiado
        const timeout = tipo === 'error' ? 4000 : 3000;
        setTimeout(function() {
            toast.style.opacity = '0';
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }, timeout);
    }
</script>

<style>
    .form-group input.error,
    .form-group select.error,
    .form-group textarea.error {
        border: 1px solid #e74c3c;
        background-color: #ffeaea;
    }
    
    .required:after {
        content: " *";
        color: #e74c3c;
    }
    
    .required-note {
        font-size: 0.85rem;
        color: var(--color-secondary);
        margin-bottom: 1.5rem;
        font-style: italic;
    }
    
    .required-note span {
        color: #e74c3c;
    }
    
    .form-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--color-accent);
    }
    
    .form-section h3 {
        margin-bottom: 1rem;
        color: var(--color-dark);
        font-size: 1.2rem;
    }
    
    .item-stock {
        font-size: 0.85rem;
        color: #666;
        margin: 0.25rem 0;
    }
    
    .quantity-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background-color: #ccc;
    }
    
    .quantity-display {
        font-weight: bold;
        color: var(--color-dark);
        min-width: 30px;
        text-align: center;
        display: inline-block;
    }
    
    .item-quantity {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    
    .toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        border-radius: 4px;
        z-index: 9999;
        font-size: 14px;
        transition: all 0.3s ease;
        opacity: 0;
        visibility: hidden;
    }
    
    .toast.show {
        opacity: 1;
        visibility: visible;
    }
    
    .toast-error {
        background-color: #e74c3c;
        color: white;
    }
    
    .toast-success {
        background-color: #2ecc71;
        color: white;
    }
    
    .stock-info {
        font-size: 0.8rem;
        color: #666;
        margin: 0.25rem 0;
    }
</style>